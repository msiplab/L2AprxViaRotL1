%%
%divide_val = [ -1.0000000000000000000000000000000000000000000000000000000, -0.9591836734693877097868153214221820235252380371093750000, -0.9183673469387754195736306428443640470504760742187500000, -0.8775510204081632403827484267822001129388809204101562500, -0.8367346938775509501695637482043821364641189575195312500, -0.7959183673469386599563790696265641599893569946289062500, -0.7551020408163264807654968535644002258777618408203125000, -0.7142857142857141905523121749865822494029998779296875000, -0.6734693877551020113614299589244183152914047241210937500, -0.6326530612244897211482452803466003388166427612304687500, -0.5918367346938775419573630642844364047050476074218750000, -0.5510204081632652517441783857066184282302856445312500000, -0.5102040816326530725532961696444544941186904907226562500, -0.4693877551020407823401114910666365176439285278320312500, -0.4285714285714285476380780437466455623507499694824218750, -0.3877551020408163129360445964266546070575714111328125000, -0.3469387755102040782340111491066636517643928527832031250, -0.3061224489795917880208264705288456752896308898925781250, -0.2653061224489795533187930232088547199964523315429687500, -0.2244897959183673186167595758888637647032737731933593750, -0.1836734693877550839147261285688728094100952148437500000, -0.1428571428571428492126926812488818541169166564941406250, -0.1020408163265306006328714261144341435283422470092773438, -0.0612244897959183659308379787944431882351636886596679688, -0.0204081632653061208204636756136096664704382419586181641, 0.0204081632653061208204636756136096664704382419586181641, 0.0612244897959183659308379787944431882351636886596679688, 0.1020408163265306006328714261144341435283422470092773438, 0.1428571428571428492126926812488818541169166564941406250, 0.1836734693877550839147261285688728094100952148437500000, 0.2244897959183673186167595758888637647032737731933593750, 0.2653061224489795533187930232088547199964523315429687500, 0.3061224489795917880208264705288456752896308898925781250, 0.3469387755102040782340111491066636517643928527832031250, 0.3877551020408163129360445964266546070575714111328125000, 0.4285714285714285476380780437466455623507499694824218750, 0.4693877551020407823401114910666365176439285278320312500, 0.5102040816326530725532961696444544941186904907226562500, 0.5510204081632652517441783857066184282302856445312500000, 0.5918367346938775419573630642844364047050476074218750000, 0.6326530612244897211482452803466003388166427612304687500, 0.6734693877551020113614299589244183152914047241210937500, 0.7142857142857141905523121749865822494029998779296875000, 0.7551020408163264807654968535644002258777618408203125000, 0.7959183673469386599563790696265641599893569946289062500, 0.8367346938775509501695637482043821364641189575195312500, 0.8775510204081632403827484267822001129388809204101562500, 0.9183673469387754195736306428443640470504760742187500000, 0.9591836734693877097868153214221820235252380371093750000, 1.0000000000000000000000000000000000000000000000000000000];
divide_val = {'-1.0000000000000000000000000000000000000000000000000000000', '-0.9591836734693877097868153214221820235252380371093750000', '-0.9183673469387754195736306428443640470504760742187500000', '-0.8775510204081632403827484267822001129388809204101562500', '-0.8367346938775509501695637482043821364641189575195312500', '-0.7959183673469386599563790696265641599893569946289062500', '-0.7551020408163264807654968535644002258777618408203125000', '-0.7142857142857141905523121749865822494029998779296875000', '-0.6734693877551020113614299589244183152914047241210937500', '-0.6326530612244897211482452803466003388166427612304687500', '-0.5918367346938775419573630642844364047050476074218750000', '-0.5510204081632652517441783857066184282302856445312500000', '-0.5102040816326530725532961696444544941186904907226562500', '-0.4693877551020407823401114910666365176439285278320312500', '-0.4285714285714285476380780437466455623507499694824218750', '-0.3877551020408163129360445964266546070575714111328125000', '-0.3469387755102040782340111491066636517643928527832031250', '-0.3061224489795917880208264705288456752896308898925781250', '-0.2653061224489795533187930232088547199964523315429687500', '-0.2244897959183673186167595758888637647032737731933593750', '-0.1836734693877550839147261285688728094100952148437500000', '-0.1428571428571428492126926812488818541169166564941406250', '-0.1020408163265306006328714261144341435283422470092773438', '-0.0612244897959183659308379787944431882351636886596679688', '-0.0204081632653061208204636756136096664704382419586181641', '0.0204081632653061208204636756136096664704382419586181641', '0.0612244897959183659308379787944431882351636886596679688', '0.1020408163265306006328714261144341435283422470092773438', '0.1428571428571428492126926812488818541169166564941406250', '0.1836734693877550839147261285688728094100952148437500000', '0.2244897959183673186167595758888637647032737731933593750', '0.2653061224489795533187930232088547199964523315429687500', '0.3061224489795917880208264705288456752896308898925781250', '0.3469387755102040782340111491066636517643928527832031250', '0.3877551020408163129360445964266546070575714111328125000', '0.4285714285714285476380780437466455623507499694824218750', '0.4693877551020407823401114910666365176439285278320312500', '0.5102040816326530725532961696444544941186904907226562500', '0.5510204081632652517441783857066184282302856445312500000', '0.5918367346938775419573630642844364047050476074218750000', '0.6326530612244897211482452803466003388166427612304687500', '0.6734693877551020113614299589244183152914047241210937500', '0.7142857142857141905523121749865822494029998779296875000', '0.7551020408163264807654968535644002258777618408203125000', '0.7959183673469386599563790696265641599893569946289062500', '0.8367346938775509501695637482043821364641189575195312500', '0.8775510204081632403827484267822001129388809204101562500', '0.9183673469387754195736306428443640470504760742187500000', '0.9591836734693877097868153214221820235252380371093750000', '1.0000000000000000000000000000000000000000000000000000000'};

for i = 0:49
    set_param(sys+"/logi_b"+num2str(i), 'const', divide_val{i+1})
end

%% model name
for k = 20:32
    %sys = "abslut50_fixpt8_19/total19/Subsystem"+num2str(k)+"bit";
    sys = "abslut50_fixpt20_32/total32/Subsystem"+num2str(k)+"bit";
    %sys = "abslut50_fixpt16/Subsystem16bit";
    
    % bit change
    for i = 0:49
        set_param(sys+"/logi_b"+num2str(i), 'gui_display_data_type', 'Fixed-point')
        set_param(sys+"/logi_b"+num2str(i), 'arith_type', 'Signed')
        
        set_param(sys+"/logi_b"+num2str(i), 'bin_pt', num2str(k-1))
        set_param(sys+"/logi_b"+num2str(i), 'n_bits', num2str(k))
    end
%     for i = 0:49
%         set_param(sys+"/logi_b"+num2str(i), 'gui_display_data_type', 'Floating-point')
%         set_param(sys+"/logi_b"+num2str(i), 'preci_type', 'Double')
%     end

    for g = 1:2
        set_param(sys+"/Gate_In"+num2str(g), 'gui_display_data_type', 'Fixed-point')
        % -1~1
        set_param(sys+"/Gate_In"+num2str(g), 'arith_type', 'Signed')
        % 0~1
        %set_param(sys+"/Gate_In"+num2str(g), 'arith_type', 'Unsigned')
        
        set_param(sys+"/Gate_In"+num2str(g), 'bin_pt', num2str(k-2))
        set_param(sys+"/Gate_In"+num2str(g), 'n_bits', num2str(k))
        set_param(sys+"/Gate_In"+num2str(g), 'quantization', 'Round  (unbiased: +/- Inf)')
        set_param(sys+"/Gate_In"+num2str(g), 'overflow', 'Saturate')
    end

    set_param(sys+"/Gate_out1", 'inherit_from_input', 'off')

    for g = 1:98
        set_param(sys+"/addsub"+num2str(g), 'precision', 'User Defined')
        set_param(sys+"/addsub"+num2str(g), 'arith_type', 'Unsigned')
        set_param(sys+"/addsub"+num2str(g), 'n_bits', '6')
        set_param(sys+"/addsub"+num2str(g), 'bin_pt', '0')
        set_param(sys+"/addsub"+num2str(g), 'quantization', 'Round  (unbiased: +/- Inf)')
        set_param(sys+"/addsub"+num2str(g), 'overflow', 'Saturate')
        set_param(sys+"/addsub"+num2str(g), 'hw_selection', 'Fabric')
        set_param(sys+"/addsub"+num2str(g), 'pipelined', 'on')
    end

    for g = 1:k
        set_param(sys+"/ROM"+num2str(g), 'distributed_mem', 'Distributed memory')
        set_param(sys+"/ROM"+num2str(g), 'latency', '0')
        set_param(sys+"/ROM"+num2str(g), 'use_rpm', 'on')
    end

    set_param(sys+"/Scaling", 'scale_factor', num2str(-(k-1)))

    set_param(sys+"/Constant1", 'n_bits', '6')
    set_param(sys+"/Constant1", 'arith_type', 'Unsigned')
    set_param(sys+"/Constant2", 'n_bits', '6')
    set_param(sys+"/Constant2", 'arith_type', 'Unsigned')
    set_param(sys+"/Constant6", 'n_bits', '6')
    set_param(sys+"/Constant6", 'arith_type', 'Unsigned')
    set_param(sys+"/Constant7", 'n_bits', '6')
    set_param(sys+"/Constant7", 'arith_type', 'Unsigned')
    
end

%% take out time from
% 8-19
% fin = find(out);
% me = zeros(1,12);
% for i = 8:19
%     for j = 1:length(fin)
%         if fin(j) == "out"+num2str(i)
%             s = get(out,char(fin(j))).signals.values;
%             me(i-7) = sum(s)/100;
%         end
%     end
% end
% abslut50_8_19 = me;

%20-32
fin = find(out);
me = zeros(1,13);
for i = 20:32
    for j = 1:length(fin)
        if fin(j) == "out"+num2str(i)
            s = get(out,char(fin(j))).signals.values;
            me(i-19) = sum(s)/100;
        end
    end
end
abslut50_20_32 = me;

figure
plot(me,'-x')

%% ketugou
abslut50 = [abslut50_8_19,abslut50_20_32];

figure
plot(abslut50,'-*')